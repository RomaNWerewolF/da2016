---
title: "lab 6"
output: html_document
---

#Задание 1
Прочитайте файл в переменную.
```{r}
TABLE = read.csv("https://raw.githubusercontent.com/SergeyMirvoda/da2016/master/lab6/wtid-report.csv", header = TRUE, sep=",")
```
На основе полученных данных создайте новую переменную в которой будут следующие колонки (наблюдения): 'Year', 'P99', 'P99.5' и 'P99.9'; это уровни дохода ,которые входят в 99-й, 99.5-й и 99.9 персентиль дохода.
```{r}
T1 = data.frame(TABLE$Year,TABLE$P99.income.threshold,TABLE$P99.5.income.threshold, TABLE$P99.9.income.threshold)
names(T1)[1:4] = c("Year", "P99", "P99.5", "P99.9")
```
Чему равнялся P99 в 1972?
```{r}
T1$P99[T1$Year==1972]
```
P99.5 в 1942? 
```{r}
T1$P99.5[T1$Year==1942]
```
P99.9 в 1922?
```{r}
T1$P99.9[T1$Year==1922]
```
Постройте диаграмму рассеяний всех трёх персентилей относительно времени. Проверьте, чтобы метки осей были корректными и на оси x были годы от 1913 до 2012.
```{r}
plot(T1$Year,T1$P99, xlim = c(1913, 2012), xlab = 'Год', ylab = 'Уровень дохода',main='Уровень дохода для P99')
plot(T1$Year,T1$P99.5, xlim = c(1913, 2012), xlab = 'Год', ylab = 'Уровень дохода',main='Уровень дохода для P99.5')
plot(T1$Year,T1$P99.9, xlim = c(1913, 2012), xlab = 'Год', ylab = 'Уровень дохода',main='Уровень дохода для P99.9')
```
Напишите функцию my.exp.estimate_ratio, которая принимает аргументы P99 и P99.9 и возвращает a, рассчитанное по формуле
```{r}
my.exp.estimate_ratio = function(x, y)
{
  z1 = c(x)
  z2 = c(y)
  a = 1-(log(10)/log(z1/z2))
  return(a)
  
  
}
```
Проверьте, что при P99 = 1e6 и P99.9 = 1e7 функция вернёт a = 2.
```{r}
my.exp.estimate_ratio(1e6, 1e7 )
```

##Задание 2
Получите значение a для каждого года в наборе данных. Если функция написана корректно вам не понадобятся циклы.  
```{r}
T1$MEER = my.exp.estimate_ratio(T1$P99, T1$P99.9)
```
Постройте график а относительно годов.Что можно сказать по полученному графику, соотносится ли это с тем, что имеется на самом деле?(Имейте ввиду, чем экспонента меньше, тем выше неравенство)
```{r}
plot(T1$Year, T1$MEER, xlab = 'Год', ylab = 'Параметр <А>',main='Параметр <А> для P99 и P99.9')
```
С 60-х по 80-е - пик экспоненты, следовательно, неравентство между P99 и P99.9 становилось меньше

Используя полученную для 2012 года оценку параметра a проверьте выполняется ли принцип Парето (20% популяции владеет 80 % богатства) однако зависит от конкретной величины k).
```{r} 
MEER2012 = T1$MEER[which(T1$Year==2012)]
w=max(subset(T1, T1$Year==2012))
xmin = w*0.8
PX = (w/xmin)^(-MEER2012+1)
PX
```
То есть 31% получают доход равный или больше, а не 20%


Из выражения (3) можно вывести следующее: (P99.5/P99.9)^(-a+1) = 5. Напишите функцию, которая будет принимать P99.5, P99.9 и a , и вычислять левую часть выражения. Отобразите полученное на графике. На нём же отобразите горизонтальную прямую с вертикальной координатой равной 5 (при помощи команды abline). Насколько качественно выполнена подгонка модели?
```{r}
P995999 = function(x1, x2,a)
{
  left=(x1/x2)^(-a+1)
  return (left)
}

```

```{r}
LP = P995999(T1$P99.5,T1$P99.9,T1$MEER)
T1 = cbind(T1,LP)

```

```{r}
plot(T1$Year, T1$LP, xlab = 'Год', ylab = 'Параметр <А>',main='Параметр <А> для P99.5 и P99.9')
abline(v=5)
```
Видно, что колебания идут возле значения равного 5, однако они достаточно обширные


Тоже самое верно и для: (P90/P95)^(-a+1) = 2. Повторите предыдущее для этой формулы. Что можно сказать, сравнив эти подгонки?
```{r}
LP0 = P995999(TABLE$P90,TABLE$P95,T1$MEER)
T1 = cbind(T1,LP0)
plot(T1$Year, T1$LP0, xlab='Год', ylab = 'Параметр <А>',main='Параметр <А> для P90 и P95')
abline(v=2)
```

Есть выброс в 30-е годы прошлого столетия, вообще первая половина столетия имела достаточный разброс, но дальше движется равномерней.
















